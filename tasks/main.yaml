---
- name: create script
  ansible.builtin.template:
    src: ../templates/install-ssh-cert.sh.j2
    dest: "{{ proxmox_ssl_script_dir }}/{{ proxmox_ssl_script_name }}"
    owner: "{{ proxmox_ssl_script_owner }}"
    group: "{{ proxmox_ssl_script_group }}"
    mode: "{{ proxmox_ssl_script_mode }}"

- name: configure cron
  ansible.builtin.cron:
    name: "{{ proxmox_ssl_cron_name }}"
    special_time: "{{ proxmox_ssl_cron_frequency }}"
    user: "{{ proxmox_ssl_script_owner }}"
    job: "{{ proxmox_ssl_script_dir }}/{{ proxmox_ssl_script_name }}"
    cron_file: "{{ proxmox_ssl_cron_file }}"

- name: run script
  ansible.builtin.command:
    cmd: "{{ proxmox_ssl_script_dir }}/{{ proxmox_ssl_script_name }}"
  become: yes
  become_user: "{{ proxmox_ssl_script_owner }}"
  when: proxmox_ssl_run_now
